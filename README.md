# PhraseCut Dataset

## Introduction
PhraseCut Dataset is aimed for the problem of segmenting anything on a image
based on a regional description phrase.

The dataset is collected based on [Visual Genome](https://visualgenome.org/).
Given an image, we randomly pick a Visual Genome box and use annotations
on that box to automatically generate a phrase.
Then we show the image and the phrase to Amazon Mechanical Turk workers
to draw the region being described by the phrase.
Each image has on average 4.5 phrases.
Each phrase can describe one or more objects, or background stuff.

Because the phrases are generated by template, each phrase can be split into
one object name (or category),
zero to multiple attribute descriptions,
and zero to multiple relationship descriptions
(plus a name of another object).

The dataset consists of 348,233 phrases in 77,262 images.
There are 308,893 phrases (71,354 images) for training,
20,350 phrase (2971 images) for validation,
and 18,980 (2937 images) held back for possible challenge evaluation in the future.
In the validation and challenge evaluation sets,
there are respectively 1000 images with dense annotations of
10.9 expressions per image on average.
We cover 3103 (1272 with frequency over 20) unique object names (categories),
12,143 (593 with frequency over 20) attribute descriptions,
and 3110 (126 with frequency over 20) relationship descriptions in the dataset.

<table width="60%">
<tr>
<td><img src="visualizations/examples.png", alt="examples" width="600"></td>
</tr>
</table>
<table width=100%>
<tr>
<td> Names</td>
<td> Attribute descriptions</td>
<td> Relationship descriptions</td>
</tr>
<tr>
<td><img src="visualizations/word_cloud_names.png", alt="names" width="300"></td>
<td><img src="visualizations/word_cloud_atts.png", alt="atts" width="300"></td>
<td><img src="visualizations/word_cloud_rels.png", alt="rels" width="300"></td>
</tr>
</table>


## Citation
\# TODO: refer to the paper.

## Download data

\# TODO: provide a link to download the dataset (excluding the test set!!!)

For users of Adobe cluster, simply create a symbolic link to the dataset in the main folder:

-  `cd PhraseCutDataset`
-  `ln -s /mnt/ilcompf8d1/user/chenwu/PhraseCut/data/refvg data`
- **Please do not use the test set to improve your model!**

## Explore the dataset
See `dataset_explore.ipynb`

## Evaluation
Input predictions, report:
- Mean box IoU (predicted boxes against ground-truth boxes), if predicted boxes are provided
- Mean mask IoU (predicted mask against ground-truth mask), if predicted masks are provided
- Box / mask accuracy: percentage of predictions where the box / mask IoU is above a threshold
(Thresholds: 0.3, 0.5, 0.7, 0.9)

The statistics can be reported on each subsets separately.

### How to run the evaluation:
`python evaluate.py`

**Evaluate your own predictor:**

- Save predictions in a numpy file
(See example predictors in `utils/eval_utils.py`.)
- Run `python evaluate.py --pred_name=your_pred --pred_path=path/to/your/predictions,npy`



### Supported subsets:

**'all':** All the data

**'c20', 'c100', 'c500', 'c500+', 'c21-100', 'c101-500':**
Rank all instance categories by their frequencies in our dataset.
'c100' means all tasks where the described instances are ranked top 100;
'c500+' means ranked after 500;
'c21-100' means ranked between 21 and 100.

**'i\_single', 'i\_multi', 'i\_many':**
The number of instances described by each phrase.
'i\_single': 1 instance;
'i\_multi': more than 1 instances;
'i\_many': more than 4 instances.

**'p\_name', 'p\_att', 'p\_att+', 'p\_rel', 'p\_rel+', 'p\_verbose':**
Phrase structure when the phrase is generated based on Visual Genome (VG) original boxes.
\[Note: instance / mask annotations from our dataset are
NOT used to decide these subsets.\]
'p\_name': Only the "name" is enough to distinguish against other VG boxes.
'p\_att': The phrase contains attributes
'p\_att+': Attributes are needed to distinguish against other VG boxes with the same name.
'p\_rel': The phrase contains relationship descriptions
'p\_rel+': Relationship descriptions are needed to distinguish against other VG boxes with the same name.
'p\_verbose': Cannot distinguish against other VG boxes.
Used all the annotations of the box to generate the phrase.

**'s\_stuff', 's\_obj':**
Whether the phrase describes stuff or objects.
See the list of pre-defined stuff names in `utils/subset`.

## Provided functions (in `utils`)
### Simple predictors
Example predictors in `utils/eval_utils.py`
### Loader
Load the dataset
### Visualize
Visualize annotations and predictions on an image.
### Data transfer
Change representations of boxes, polygons, masks, etc.
### IoU
Calculate IoU between boxes, polygons, masks, etc.
### Subset
Decide qualified subsets for each data sample.  



